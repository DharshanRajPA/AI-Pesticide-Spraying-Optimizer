# Segmentation Model Configuration for AgriSprayAI
# Defines the segmentation pipeline with severity extraction

# Model Configuration
model:
  name: "yolov8m"  # Use medium model for segmentation
  input_size: [640, 640]
  num_classes: 10  # Adjust based on your pest/disease categories
  severity_head: true  # Enable severity extraction head

# Training Configuration
training:
  epochs: 100
  batch_size: 8  # Smaller batch size for segmentation
  learning_rate: 0.001
  weight_decay: 0.0001
  momentum: 0.937
  warmup_epochs: 3
  warmup_momentum: 0.8
  warmup_bias_lr: 0.1
  
  # Multi-task loss weights
  loss_weights:
    segmentation: 1.0
    severity: 0.3

# Data Configuration
data:
  train_path: "data/annotated/instances_train.json"
  val_path: "data/annotated/instances_val.json"
  test_path: "data/annotated/instances_test.json"
  
  # COCO format with custom severity field
  format: "coco"
  custom_fields:
    - "severity"  # Integer 0-3 for disease severity
  
  # Augmentation for segmentation
  augmentation:
    hsv_h: 0.015
    hsv_s: 0.7
    hsv_v: 0.4
    degrees: 0.0
    translate: 0.1
    scale: 0.5
    shear: 0.0
    perspective: 0.0
    flipud: 0.0
    fliplr: 0.5
    mosaic: 1.0
    mixup: 0.0

# Validation Configuration
validation:
  metrics:
    - "mIoU"  # Mean Intersection over Union
    - "mAP_seg"  # Mean Average Precision for segmentation
    - "severity_mae"  # Mean Absolute Error for severity prediction
    - "severity_accuracy"  # Accuracy for severity classification
  
  # Target performance
  targets:
    miou: 0.60
    map_seg: 0.50
    severity_mae: 0.3
    severity_accuracy: 0.80

# Optimization Configuration
optimization:
  optimizer: "AdamW"
  scheduler: "cosine"
  early_stopping:
    patience: 20
    min_delta: 0.001
  
  # Mixed precision training
  mixed_precision: true
  
  # Gradient clipping
  gradient_clip: 10.0

# Model Export Configuration
export:
  formats:
    - "onnx"
    - "tensorrt"
    - "tflite"
  
  # Quantization for edge deployment
  quantization:
    onnx: true
    tflite: true
    tensorrt: true
  
  # Optimization for edge
  optimization_level: "O3"

# Logging and Monitoring
logging:
  log_dir: "logs/segmentation_training"
  log_interval: 100
  save_interval: 10
  
  # Weights & Biases integration
  wandb:
    enabled: true
    project: "agrispray-ai-segmentation"
    entity: "your-entity"
  
  # MLflow integration
  mlflow:
    enabled: true
    experiment_name: "segmentation_with_severity"

# Hardware Configuration
hardware:
  device: "auto"  # auto, cpu, cuda, mps
  num_workers: 4
  pin_memory: true
  
  # Multi-GPU training
  distributed:
    enabled: false
    backend: "nccl"
